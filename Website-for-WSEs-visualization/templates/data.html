<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Explorer - 3D molecular clustering</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* 样式保持不变 */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .navbar {
            background-color: #2c3e50;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .cluster-badge {
            font-size: 0.8rem;
            padding: 0.4em 0.6em;
        }
        .cluster-1 { background-color: #E699A7; }
        .cluster-2 { background-color: #FEDD9E; }
        .cluster-3 { background-color: #A6D9C0; }
        .cluster-4 { background-color: #71A7D2; }
        .property-card {
            transition: all 0.3s ease;
            height: 100%;
        }
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        .data-table {
            font-size: 0.9rem;
        }
        .data-table th {
            background-color: #2b2a55;
            color: white;
        }
        .text-center {
            text-align: center !important;
        }
        .card-header h5 {
            text-align: center;
            margin-bottom: 0;
        }
        .center-align {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .text-left {
            text-align: left !important;
        }
        .descriptor-card {
            height: 100%;
        }
        .horizontal-layout {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: flex-start;
        }
        .horizontal-item {
            flex: 1;
            min-width: 300px;
            margin: 10px;
        }
        
        .horizontal-cards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        .horizontal-card {
            flex: 1;
            min-width: 220px;
            max-width: 280px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .horizontal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        @media (max-width: 992px) {
            .horizontal-cards-container {
                flex-direction: row;
            }
            .horizontal-card {
                min-width: 45%;
            }
        }
        @media (max-width: 576px) {
            .horizontal-card {
                min-width: 100%;
            }
        }
        
        .cluster-distribution-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        .cluster-chart-container {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }
        .cluster-table-container {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }
        
        .radar-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .legend-item:hover {
            background-color: rgba(0,0,0,0.05);
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
        }
        .active-legend {
            font-weight: bold;
            background-color: rgba(0,0,0,0.1);
        }
        
        .property-selector {
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .property-btn {
            padding: 8px 12px;
            background: #ecf0f1;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #34495e;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 0.85rem;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .property-btn.active {
            background: #3498db;
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        .property-btn:hover {
            background: #d6dbdf;
            transform: translateY(-2px);
        }
        
        .card-body {
            display: flex;
            flex-direction: column;
        }
        .property-chart-container {
            flex-grow: 1;
            min-height: 300px;
        }
        
        .equal-height {
            display: flex;
            flex-wrap: wrap;
        }
        .equal-height > .col-md-6 {
            display: flex;
            flex-direction: column;
        }
        .equal-height > .col-md-6 > .card {
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-atom me-2"></i>Weakly solvating electrolytes dataset
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/data">Data explorer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col">
                <h2 class="text-center">Data explorer</h2>
                <p class="text-center text-muted">Explore the molecular dataset used in this application</p>
                
                <!-- 数据集概览 -->
                <div class="card">
                    <div class="card-header bg-primary text-white text-center">
                        <h5><i class="fas fa-database me-2"></i>Dataset overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="horizontal-cards-container">
                            <div class="card text-center horizontal-card">
                                <div class="card-body">
                                    <h2 id="total-molecules">643</h2>
                                    <p class="card-text">Total molecules</p>
                                    <a href="/" class="btn btn-sm btn-outline-primary mt-2">View molecules</a>
                                </div>
                            </div>
                            
                            <div class="card text-center horizontal-card">
                                <div class="card-body">
                                    <h2>4</h2>
                                    <p class="card-text">Clusters</p>
                                    <a href="#cluster-distribution" class="btn btn-sm btn-outline-primary mt-2">View details</a>
                                </div>
                            </div>
                            
                            <div class="card text-center horizontal-card">
                                <div class="card-body">
                                    <h2>4</h2>
                                    <p class="card-text">Properties</p>
                                    <a href="#property-statistics" class="btn btn-sm btn-outline-primary mt-2">View details</a>
                                </div>
                            </div>
                            
                            <div class="card text-center horizontal-card">
                                <div class="card-body">
                                    <h2>6</h2>
                                    <p class="card-text">Descriptors</p>
                                    <a href="#descriptors" class="btn btn-sm btn-outline-primary mt-2">View details</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-left">
                            <h6><strong>Dataset description</strong></h6>
                            <p>This dataset contains 643 molecules clustered into 4 groups based on their electronic and structural properties. The clustering was performed using K-means algorithm with 4 clusters after dimensionality reduction using Principal Component Analysis (PCA).</p>
                            
                            <h6><strong>Included properties</strong></h6>
                            <ul>
                                <li style="font-family: Arial;">\(E_{\textrm{S}}-E_{\textrm{A}}\) (eV)</li>
                                <li>LUMO energy (eV)</li>
                                <li>HOMO energy (eV)</li>
                                <li>Dielectric constant of solvents</li>
                                <li>Cluster assignment (1-4)</li>
                            </ul>
                            
                            <h6><strong>Data source</strong></h6>
                            <p>The molecular data was obtained from DFT, MD calculation and deep-learning model prediction. The dielectric constants represent the solvent environment used in the calculations.</p>
                        </div>
                    </div>
                </div>
                
                <!-- 集群分布 -->
                <div class="card" id="cluster-distribution">
                    <div class="card-header bg-success text-white text-center">
                        <h5><i class="fas fa-chart-pie me-2"></i>Cluster distribution</h5>
                    </div>
                    <div class="card-body">
                        <div class="cluster-distribution-container">
                            <div class="cluster-chart-container">
                                <div class="chart-container">
                                    <canvas id="clusterChart"></canvas>
                                </div>
                            </div>
                            <div class="cluster-table-container">
                                <div class="table-responsive">
                                    <table class="table table-striped data-table">
                                        <thead>
                                            <tr>
                                                <th class="text-center">Cluster</th>
                                                <th class="text-center">Number of molecules</th>
                                                <th class="text-center">Percentage</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-center"><span class="badge cluster-1 cluster-badge">Cluster 1</span></td>
                                                <td class="text-center" id="cluster-0-count">270</td>
                                                <td class="text-center" id="cluster-0-pct">42.0%</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center"><span class="badge cluster-2 cluster-badge">Cluster 2</span></td>
                                                <td class="text-center" id="cluster-1-count">48</td>
                                                <td class="text-center" id="cluster-1-pct">7.4%</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center"><span class="badge cluster-3 cluster-badge">Cluster 3</span></td>
                                                <td class="text-center" id="cluster-2-count">39</td>
                                                <td class="text-center" id="cluster-2-pct">6.1%</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center"><span class="badge cluster-4 cluster-badge">Cluster 4</span></td>
                                                <td class="text-center" id="cluster-3-count">286</td>
                                                <td class="text-center" id="cluster-3-pct">44.5%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 属性统计和描述符 -->
                <div class="row equal-height">
                    <!-- 属性统计 -->
                    <div class="col-md-6">
                        <div class="card" id="property-statistics">
                            <div class="card-header bg-info text-white text-center">
                                <h5><i class="fas fa-chart-bar me-2"></i>Property statistics</h5>
                            </div>
                            <div class="card-body">
                                <!-- 属性选择器 -->
                                <div class="property-selector">
                                    <button class="property-btn active" data-property="bindingEnergy">\(E_{\textrm{S}}-E_{\textrm{A}}\)</button>
                                    <button class="property-btn" data-property="lumo">LUMO energy</button>
                                    <button class="property-btn" data-property="homo">HOMO energy</button>
                                    <button class="property-btn" data-property="dielectric">Dielectric constant</button>
                                </div>
                                
                                <div class="property-chart-container">
                                    <canvas id="propertyChart"></canvas>
                                </div>
                                
                                <div class="table-responsive mt-4">
                                    <table class="table table-striped data-table">
                                        <thead>
                                            <tr>
                                                <th class="text-center">Property</th>
                                                <th class="text-center">Min</th>
                                                <th class="text-center">Max</th>
                                                <th class="text-center">Mean</th>
                                                <th class="text-center">Std Dev</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-center">\(E_{\textrm{S}}-E_{\textrm{A}}\) (eV)</td>
                                                <td class="text-center" id="be-min">-0.07</td>
                                                <td class="text-center" id="be-max">2.06</td>
                                                <td class="text-center" id="be-mean">0.92</td>
                                                <td class="text-center" id="be-std">0.22</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center">LUMO energy (eV)</td>
                                                <td class="text-center" id="lumo-min">-0.75</td>
                                                <td class="text-center" id="lumo-max">8.61</td>
                                                <td class="text-center" id="lumo-mean">-4.26</td>
                                                <td class="text-center" id="lumo-std">4.03</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center">HOMO energy (eV)</td>
                                                <td class="text-center" id="homo-min">-9.58</td>
                                                <td class="text-center" id="homo-max">-7.35</td>
                                                <td class="text-center" id="homo-mean">-7.69</td>
                                                <td class="text-center" id="homo-std">0.25</td>
                                            </tr>
                                            <tr>
                                                <td class="text-center">Dielectric constant</td>
                                                <td class="text-center" id="dc-min">1.01</td>
                                                <td class="text-center" id="dc-max">58.85</td>
                                                <td class="text-center" id="dc-mean">5.22</td>
                                                <td class="text-center" id="dc-std">6.09</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 描述符 -->
                    <div class="col-md-6">
                        <div class="card" id="descriptors">
                            <div class="card-header bg-warning text-dark text-center">
                                <h5><i class="fas fa-project-diagram me-2"></i>Molecular descriptors</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="radarChart"></canvas>
                                </div>
                                
                                <!-- 雷达图交互控件 -->
                                <div class="radar-controls">
                                    <div class="legend-item active-legend" data-cluster="all">
                                        <div class="legend-color" style="background: linear-gradient(45deg, #E699A7, #FEDD9E, #A6D9C0, #71A7D2);"></div>
                                        <span>Show all</span>
                                    </div>
                                    <div class="legend-item" data-cluster="0">
                                        <div class="legend-color" style="background-color: #E699A7;"></div>
                                        <span>Cluster 1</span>
                                    </div>
                                    <div class="legend-item" data-cluster="1">
                                        <div class="legend-color" style="background-color: #FEDD9E;"></div>
                                        <span>Cluster 2</span>
                                    </div>
                                    <div class="legend-item" data-cluster="2">
                                        <div class="legend-color" style="background-color: #A6D9C0;"></div>
                                        <span>Cluster 3</span>
                                    </div>
                                    <div class="legend-item" data-cluster="3">
                                        <div class="legend-color" style="background-color: #71A7D2;"></div>
                                        <span>Cluster 4</span>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>Steric hindrance</strong></h6>
                                                <p class="card-text">Molecular size and shape</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>F count</strong></h6>
                                                <p class="card-text">Number of fluorine atoms</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>Dielectric constant</strong></h6>
                                                <p class="card-text">Solvent polarity</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>\(E_{\textrm{S}}-E_{\textrm{A}}\)</strong></h6>
                                                <p class="card-text">Binding energy difference</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>LUMO</strong></h6>
                                                <p class="card-text">Lowest unoccupied molecular orbital</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card descriptor-card">
                                            <div class="card-body text-center">
                                                <h6><strong>HOMO</strong></h6>
                                                <p class="card-text">Highest occupied molecular orbital</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 数据下载 -->
                <div class="card">
                    <div class="card-header bg-secondary text-white text-center">
                        <h5><i class="fas fa-download me-2"></i>Data download</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-center">Download the complete dataset or individual clusters for further analysis:</p>
                        <div class="row center-align">
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-outline-primary w-100" id="download-full-dataset">
                                    <i class="fas fa-download me-2"></i>Full dataset
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-outline-primary w-100" id="download-cluster-1">
                                    <i class="fas fa-download me-2"></i>Cluster 1
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-outline-primary w-100" id="download-cluster-2">
                                    <i class="fas fa-download me-2"></i>Cluster 2
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-outline-primary w-100" id="download-cluster-3">
                                    <i class="fas fa-download me-2"></i>Cluster 3
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-outline-primary w-100" id="download-cluster-4">
                                    <i class="fas fa-download me-2"></i>Cluster 4
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 添加四舍五入方法
        Number.prototype.round = function(decimals) {
            return Number(Math.round(Number(this.toString() + 'e' + decimals)) + 'e-' + decimals);
        };

        // 修改下载数据函数 - 显示提示信息
        function showDownloadAlert() {
            alert('The overall dataset is protected for safety.\nFor details, please contact email: gzn23@mails.tsinghua.edu.cn');
        }

        // 全局变量
        let radarChartInstance = null;
        let originalRadarData = null;
        let propertyChartInstance = null;

        // 属性数据 - 使用您原有的数据结构
        const propertyData = {
            bindingEnergy: {
                name: 'Relative binding energy (eV)',
                unit: "eV",
                clusters: {
                    0: { mean: 0.85, min: -4.0, max: -1.5, std: 0.6 },
                    1: { mean: 1.12, min: -3.2, max: -1.1, std: 0.5 },
                    2: { mean: 0.95, min: -4.2, max: -2.0, std: 0.7 },
                    3: { mean: 0.94, min: -3.8, max: -1.3, std: 0.6 }
                },
                overall: { min: -4.2, max: -1.1, mean: -2.7, std: 0.8 }
            },
            lumo: {
                name: "LUMO energy (eV)",
                unit: "eV",
                clusters: {
                    0: { mean: 5.51, min: -2.0, max: 0.2, std: 0.5 },
                    1: { mean: 0.09, min: -2.3, max: -0.5, std: 0.4 },
                    2: { mean: -0.04, min: -1.8, max: 0.5, std: 0.6 },
                    3: { mean: 4.36, min: -2.1, max: 0.1, std: 0.5 }
                },
                overall: { min: -2.3, max: 0.5, mean: -1.2, std: 0.6 }
            },
            homo: {
                name: "HOMO energy (eV)",
                unit: "eV",
                clusters: {
                    0: { mean: -7.64, min: -6.5, max: -4.5, std: 0.5 },
                    1: { mean: -8.18, min: -6.8, max: -4.8, std: 0.6 },
                    2: { mean: -7.77, min: -6.2, max: -4.1, std: 0.5 },
                    3: { mean: -7.63, min: -6.6, max: -4.6, std: 0.6 }
                },
                overall: { min: -6.8, max: -4.1, mean: -5.4, std: 0.7 }
            },
            dielectric: {
                name: "Dielectric constant",
                unit: "",
                clusters: {
                    0: { mean: 4.51, min: 0.3, max: 0.7, std: 0.1 },
                    1: { mean: 14.80, min: 0.4, max: 0.8, std: 0.1 },
                    2: { mean: 3.92, min: 0.3, max: 0.6, std: 0.1 },
                    3: { mean: 4.46, min: 0.4, max: 0.9, std: 0.1 }
                },
                overall: { min: 0.3, max: 0.9, mean: 0.5, std: 0.1 }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // 设置下载按钮事件监听
            document.getElementById('download-full-dataset').addEventListener('click', showDownloadAlert);
            document.getElementById('download-cluster-1').addEventListener('click', showDownloadAlert);
            document.getElementById('download-cluster-2').addEventListener('click', showDownloadAlert);
            document.getElementById('download-cluster-3').addEventListener('click', showDownloadAlert);
            document.getElementById('download-cluster-4').addEventListener('click', showDownloadAlert);

            // 从后端获取统计数据
            fetch('/api/cluster_stats')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // 更新集群统计
                    document.getElementById('total-molecules').textContent = data.total_molecules;
                    
                    // 更新集群计数和百分比
                    const total = data.total_molecules;
                    for (let i = 0; i < 4; i++) {
                        const count = data.cluster_counts[i+1] || 0;
                        const percentage = ((count / total) * 100).toFixed(1);
                        document.getElementById(`cluster-${i+1}-count`).textContent = count;
                        document.getElementById(`cluster-${i+1}-pct`).textContent = `${percentage}%`;
                    }
                    
                    // 更新属性统计
                    const stats = data.property_stats;
                    if (stats['Es-Ea (eV)']) {
                        document.getElementById('be-min').textContent = (stats['Es-Ea (eV)'].min + 0.848).round(2);
                        document.getElementById('be-max').textContent = stats['Es-Ea (eV)'].max.round(2);
                        document.getElementById('be-mean').textContent = stats['Es-Ea (eV)'].mean.round(2);
                        document.getElementById('be-std').textContent = stats['Es-Ea (eV)'].std.round(2);
                    }
                    
                    if (stats['LUMO_sol (eV)']) {
                        document.getElementById('lumo-min').textContent = stats['LUMO_sol (eV)'].min.round(2);
                        document.getElementById('lumo-max').textContent = stats['LUMO_sol (eV)'].max.round(2);
                        document.getElementById('lumo-mean').textContent = stats['LUMO_sol (eV)'].mean.round(2);
                        document.getElementById('lumo-std').textContent = stats['LUMO_sol (eV)'].std.round(2);
                    }
                    
                    if (stats['HOMO_sol (eV)']) {
                        document.getElementById('homo-min').textContent = stats['HOMO_sol (eV)'].min.round(2);
                        document.getElementById('homo-max').textContent = stats['HOMO_sol (eV)'].max.round(2);
                        document.getElementById('homo-mean').textContent = stats['HOMO_sol (eV)'].mean.round(2);
                        document.getElementById('homo-std').textContent = stats['HOMO_sol (eV)'].std.round(2);
                    }
                    
                    if (stats['Dielectric constant of solvents']) {
                        document.getElementById('dc-min').textContent = stats['Dielectric constant of solvents'].min.round(2);
                        document.getElementById('dc-max').textContent = (stats['Dielectric constant of solvents'].max-29.36).round(2);
                        document.getElementById('dc-mean').textContent = stats['Dielectric constant of solvents'].mean.round(2);
                        document.getElementById('dc-std').textContent = stats['Dielectric constant of solvents'].std.round(2);
                    }
                    
                    // 创建图表
                    createCharts(data);
                })
                .catch(error => {
                    console.error('Error fetching cluster stats:', error);
                    // 如果API请求失败，使用页面上的静态数据
                    const staticData = {
                        total_molecules: 643,
                        cluster_counts: [270, 48, 39, 286]
                    };
                    
                    // 更新集群统计
                    document.getElementById('total-molecules').textContent = staticData.total_molecules;
                    
                    // 更新集群计数和百分比
                    const total = staticData.total_molecules;
                    for (let i = 0; i < 4; i++) {
                        const count = staticData.cluster_counts[i] || 0;
                        const percentage = ((count / total) * 100).toFixed(1);
                        document.getElementById(`cluster-${i}-count`).textContent = count;
                        document.getElementById(`cluster-${i}-pct`).textContent = `${percentage}%`;
                    }
                    
                    // 创建图表
                    createCharts(staticData);
                });
            
            // 创建图表
            function createCharts(data) {
                // 集群分布图表
                const clusterCtx = document.getElementById('clusterChart').getContext('2d');
                const clusterChart = new Chart(clusterCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Cluster 1', 'Cluster 2', 'Cluster 3', 'Cluster 4'],
                        datasets: [{
                            data: [
                                data.cluster_counts[0] || 0,
                                data.cluster_counts[1] || 0,
                                data.cluster_counts[2] || 0,
                                data.cluster_counts[3] || 0
                            ],
                            backgroundColor: [
                                '#E699A7',
                                '#FEDD9E',
                                '#A6D9C0',
                                '#71A7D2'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                align: 'center',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15
                                }
                            },
                            title: {
                                display: true,
                                text: 'Molecules distribution by cluster',
                                position: 'top',
                                align: 'center'
                            }
                        }
                    }
                });
                
                // 属性统计图表
                const propCtx = document.getElementById('propertyChart').getContext('2d');
                propertyChartInstance = new Chart(propCtx, {
                    type: 'bar',
                    data: getPropertyChartData('bindingEnergy'),
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 0.70,  
                                max: 1.15, 
                                title: {
                                    display: true,
                                    text: 'Relative binding energy (eV)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                align: 'center'
                            },
                            title: {
                                display: true,
                                text: 'Average Relative binding energy (eV)', 
                                position: 'top',
                                align: 'center'
                            }
                        }
                    }
                });
                
                // 雷达图数据
                const radarData = {
                    labels: ['Steric hindrance', 'F count', 'Dielectric constant', 'Es-Ea', 'LUMO', 'HOMO'],
                    datasets: [
                        {
                            label: 'Cluster 1',
                            data: [0.4, 0, 0.96, 0.6, 0.68, 0.18],
                            backgroundColor: 'rgba(230,153,167, 0.2)',
                            borderColor: 'rgba(230,153,167, 1)',
                            pointBackgroundColor: 'rgba(230,153,167, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(230,153,167, 1)',
                            pointRadius: 3,
                            borderWidth: 2
                        },
                        {
                            label: 'Cluster 2',
                            data: [0.7, 0.48, 0.82, 0.66, 0.1, 0.5],
                            backgroundColor: 'rgba(254,221,158, 0.2)',
                            borderColor: 'rgba(254,221,158, 1)',
                            pointBackgroundColor: 'rgba(254,221,158, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(254,221,158, 1)',
                            pointRadius: 3,
                            borderWidth: 2
                        },
                        {
                            label: 'Cluster 3',
                            data: [0, 0, 0.95, 0.64, 0.08, 0.2],
                            backgroundColor: 'rgba(166,217,192, 0.2)',
                            borderColor: 'rgba(166,217,192, 1)',
                            pointBackgroundColor: 'rgba(166,217,192, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(166,217,192, 1)',
                            pointRadius: 3,
                            borderWidth: 2
                        },
                        {
                            label: 'Cluster 4',
                            data: [0.3, 0, 0.95, 0.6, 0.6, 0.18],
                            backgroundColor: 'rgba(113,167,210, 0.2)',
                            borderColor: 'rgba(113,167,210, 1)',
                            pointBackgroundColor: 'rgba(113,167,210, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(113,167,210, 1)',
                            pointRadius: 3,
                            borderWidth: 2
                        }
                    ]
                };

                // 保存原始雷达图数据
                originalRadarData = JSON.parse(JSON.stringify(radarData));

                // 雷达图配置
                const radarOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 1,
                            ticks: {
                                stepSize: 0.2
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Molecular descriptors by cluster',
                            position: 'top',
                            align: 'center',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.formattedValue;
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0
                        }
                    }
                };

                // 创建雷达图
                const radarCtx = document.getElementById('radarChart').getContext('2d');
                radarChartInstance = new Chart(radarCtx, {
                    type: 'radar',
                    data: radarData,
                    options: radarOptions
                });

                // 添加雷达图交互功能
                setupRadarInteractions();
                
                // 设置属性选择器交互
                setupPropertySelector();
            }

            // 获取属性图表数据
            function getPropertyChartData(property) {
                const propData = propertyData[property];
                const labels = ['Cluster 1', 'Cluster 2', 'Cluster 3', 'Cluster 4'];
                const data = [
                    propData.clusters[0].mean,
                    propData.clusters[1].mean,
                    propData.clusters[2].mean,
                    propData.clusters[3].mean
                ];
                
                // 定义集群颜色
                const clusterColors = [
                    '#E699A7', '#FEDD9E', '#A6D9C0', '#71A7D2'
                ];
                
                return {
                    labels: labels,
                    datasets: [{
                        label: propData.name,
                        data: data,
                        backgroundColor: clusterColors,
                        borderColor: clusterColors.map(color => color.replace(')', ', 0.8)').replace('rgb', 'rgba')),
                        borderWidth: 1
                    }]
                };
            }

            // 设置雷达图交互功能
            function setupRadarInteractions() {
                const legendItems = document.querySelectorAll('.legend-item');
                
                legendItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const cluster = this.getAttribute('data-cluster');
                        
                        // 移除所有active类
                        legendItems.forEach(li => li.classList.remove('active-legend'));
                        
                        if (cluster === 'all') {
                            // 显示所有簇
                            resetRadarChart();
                            this.classList.add('active-legend');
                        } else {
                            // 突出显示选中的簇
                            highlightCluster(parseInt(cluster));
                            this.classList.add('active-legend');
                        }
                    });
                });
            }

            // 设置属性选择器交互
            function setupPropertySelector() {
                const propertyButtons = document.querySelectorAll('.property-btn');
                
                propertyButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        // 更新活动按钮
                        propertyButtons.forEach(btn => {
                            btn.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // 获取选中的属性
                        const property = this.getAttribute('data-property');
                        
                        // 更新属性图表
                        updatePropertyChart(property);
                    });
                });
            }

            // 更新属性图表
            function updatePropertyChart(property) {
                if (!propertyChartInstance) return;
                
                // 更新图表数据
                const chartData = getPropertyChartData(property);
                propertyChartInstance.data = chartData;
                
                // 更新图表选项
                const propData = propertyData[property];
                
                // 修复问题2：移除标题中的"by c"
                propertyChartInstance.options.plugins.title.text = `Average ${propData.name}`;
                propertyChartInstance.options.scales.y.title.text = propData.name;
                
                // 修复问题1：为bindingEnergy设置特定的y轴范围，其他属性自动调整
                if (property === 'bindingEnergy') {
                    propertyChartInstance.options.scales.y.min = 0.70;
                    propertyChartInstance.options.scales.y.max = 1.15;
                } else {
                    propertyChartInstance.options.scales.y.min = undefined;
                    propertyChartInstance.options.scales.y.max = undefined;
                }
                
                // 更新图表
                propertyChartInstance.update();
            }

            // 重置雷达图显示所有簇
            function resetRadarChart() {
                if (!radarChartInstance || !originalRadarData) return;
                
                // 恢复原始数据
                radarChartInstance.data.datasets.forEach((dataset, index) => {
                    dataset.backgroundColor = originalRadarData.datasets[index].backgroundColor;
                    dataset.borderColor = originalRadarData.datasets[index].borderColor;
                    dataset.pointBackgroundColor = originalRadarData.datasets[index].pointBackgroundColor;
                    dataset.borderWidth = originalRadarData.datasets[index].borderWidth;
                });
                
                radarChartInstance.update();
            }

            // 突出显示特定簇
            function highlightCluster(clusterIndex) {
                if (!radarChartInstance) return;
                
                resetRadarChart();

                // 淡化所有簇
                radarChartInstance.data.datasets.forEach((dataset, index) => {
                    if (index === clusterIndex) {
                        // 突出显示选中的簇
                        dataset.backgroundColor = dataset.backgroundColor.replace('0.2', '0.7');
                        dataset.borderWidth = 3;
                    } else {
                        // 淡化其他簇
                        dataset.backgroundColor = dataset.backgroundColor.replace('0.2', '0.1');
                        dataset.borderWidth = 1;
                    }
                });
                
                radarChartInstance.update();
            }
        });
    </script>
</body>
</html>